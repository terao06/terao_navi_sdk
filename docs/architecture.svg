<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <style>
      .box { fill: white; stroke: #333; stroke-width: 2; }
      .external-box { fill: #e3f2fd; }
      .nextjs-box { fill: #f3e5f5; }
      .api-box { fill: #fff3e0; }
      .text { font-family: Arial, sans-serif; font-size: 13px; fill: #333; }
      .text-small { font-family: Arial, sans-serif; font-size: 11px; fill: #555; }
      .title { font-weight: bold; font-size: 16px; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-dashed { stroke: #666; stroke-width: 2; fill: none; stroke-dasharray: 5,5; marker-end: url(#arrowhead); }
      .arrow-label { font-family: Arial, sans-serif; font-size: 12px; fill: #666; font-style: italic; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <!-- External Website -->
  <rect class="box external-box" x="20" y="20" width="420" height="160" rx="8"/>
  <text class="text title" x="40" y="45">外部Webサイト (HTML)</text>
  <rect class="box" x="40" y="60" width="380" height="105" rx="4"/>
  <text class="text-small" x="50" y="78">&lt;div id="terao-navi-chat"&gt;&lt;/div&gt;</text>
  <text class="text-small" x="50" y="95">&lt;script src="http://localhost:3000/chat.js"</text>
  <text class="text-small" x="70" y="110">data-credential="YOUR_BASE64_ENCODED_CREDENTIAL"</text>
  <text class="text-small" x="70" y="125">data-chat-title="AIチャットへ質問する"</text>
  <text class="text-small" x="70" y="140">data-chat-color="#667eea"&gt;</text>
  <text class="text-small" x="50" y="155">&lt;/script&gt;</text>
  
  <!-- Arrow 1 -->
  <path class="arrow" d="M 230 180 L 230 220"/>
  <text class="arrow-label" x="240" y="205">chat.jsがiframe生成</text>
  
  <!-- Next.js Server -->
  <rect class="box nextjs-box" x="20" y="220" width="420" height="300" rx="8"/>
  <text class="text title" x="40" y="245">Next.js Server (localhost:3000)</text>
  
  <!-- Widget Page -->
  <rect class="box" x="40" y="260" width="380" height="95" rx="4"/>
  <text class="text title" x="60" y="280">/widget (Page)</text>
  <text class="text" x="60" y="300" font-size="12">• URLパラメータから設定取得</text>
  <text class="text-small" x="70" y="317">(credential, origin, referer, chatTitle, chatColor)</text>
  <text class="text" x="60" y="335" font-size="12">• ChatWidgetをレンダリング</text>
  
  <!-- Arrow between Widget and API -->
  <path class="arrow" d="M 230 355 L 230 400"/>
  <text class="arrow-label" x="240" y="380">POST /api/chat</text>
  
  <!-- API Route -->
  <rect class="box" x="40" y="400" width="380" height="95" rx="4"/>
  <text class="text title" x="60" y="420">/api/chat (API Route)</text>
  <text class="text" x="60" y="440" font-size="12">• 認証情報の検証</text>
  <text class="text" x="60" y="460" font-size="12">• TeraoNaviClientを使用</text>
  <text class="text-small" x="70" y="477">(トークン自動管理)</text>
  
  <!-- Arrow 2 -->
  <path class="arrow" d="M 230 520 L 230 550"/>
  <text class="arrow-label" x="240" y="540">APIリクエスト</text>
  
  <!-- Terao Navi API -->
  <rect class="box api-box" x="20" y="550" width="420" height="120" rx="8"/>
  <text class="text title" x="40" y="575">Terao Navi API (外部API)</text>
  <text class="text" x="40" y="598" font-size="12">• Basic認証 → Bearer Token取得</text>
  <text class="text" x="40" y="620" font-size="12">• 質問応答API (LLMで回答生成)</text>
  <text class="text" x="40" y="642" font-size="12">• トークンリフレッシュ (自動更新)</text>
  
  <!-- Data Flow Labels on the right -->
  <text class="text" x="480" y="100" font-size="13" fill="#666" font-weight="bold">データフロー:</text>
  <text class="text" x="480" y="130" font-size="12" fill="#666">1. ユーザーがメッセージ入力</text>
  <text class="text" x="480" y="200" font-size="12" fill="#666">2. chat.jsがiframe生成</text>
  <text class="text" x="480" y="330" font-size="12" fill="#666">3. Widget→API Route</text>
  <text class="text" x="480" y="450" font-size="12" fill="#666">4. TeraoNaviClient実行</text>
  <text class="text" x="480" y="600" font-size="12" fill="#666">5. LLMで回答生成</text>
  <text class="text" x="480" y="630" font-size="12" fill="#666">6. ユーザーに回答表示</text>
</svg>
